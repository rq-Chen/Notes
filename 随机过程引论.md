# 随机过程引论

第二章到第五章要掌握。



## 第一章 随机过程初步

### 概率论基础

- 独立性和不相关性：

  - 相关一般指皮尔逊（线性）相关，但独立性包括各种类型的联系，指的是联合分布等于边缘分布的乘积
- 独立一定不相关，不相关不一定独立
  
  - 例：PCA的因子线性不相关但不一定独立，ICA的因子线性不相关且独立
  
- 条件分布：

  $$F_{X|Y}(x|y)$$是条件分布的三个要求：

  1. 它在固定y之后是x的分布函数
  2. 它在固定x之后是y的函数
  3. 它满足：$$F(x,y) = \int_{\eta \le y} F_{X|Y}(x|\eta) dF_y(\eta)$$，令y趋于无穷可得全概公式

- 特征函数和母函数：

  随机变量X的特征函数是一个定义在实轴上的虚函数：$$\phi(t) = E[e^{itX}]$$，可以由它推出X的分布函数以及X的各阶矩（通过微分）。即以X的分布函数为系数的傅里叶逆变换。

  非负随机变量的母函数是复变函数$$g(s) = E[s^X]$$，其中s是模不大于1的复数。类似Z变换的逆变换。

  如果是随机向量，那么特征函数和母函数也是多元函数，对应随机向量的维数。

### 随机过程初步

- 布朗运动（维纳过程）：见PPT第16页，重点是独立增量、平稳增量和正态条件分布。
- 泊松过程：见17页，也是独立平稳增量，其含义是在任意时间内发生一次事件的概率与区间长度成正比，而发生两次或更多事件的概率忽略不计，并且不同区间内相互独立

- 指标集：不一定是一维的（离散时间或连续时间），也可以是空间过程，比如海浪的指标集是经纬度而不是时间

### 随机过程的例子

- 平稳独立增量过程：
  - 独立增量指$$X_{t + 1} - X_{t}$$对所有t独立，且与$$X_0$$也独立
  - 平稳指$$X_{t + \tau} - X_t$$分布只与$$\tau$$有关而与t无关（见下面平稳过程的定义）
  - 其在t时刻的均值和方差都是t的线性函数，经过$$(0, m_0),(1, m_1)$$或$$(0,\sigma^2_0),(1, \sigma^2_1)$$
- 鞅：大意是任意给定一个历史，都有下一时刻的期望等于最后时刻的取值，类似公平赌博的模型。也可理解为一个增量期望均为0的独立增量过程。
- 马尔科夫过程：
  - 大意是只要给定$$X_{t_0}$$，则对任意$$t_1<t_0<t_2$$，$$X_{t_1}$$与$$X_{t_2}$$无关。
  - 转移概率函数$$P(x, s; t, A) = Pr\{X_t \in A | X_s = x \}$$决定了整个过程的联合概率分布。若它只是t - s的函数，称该过程有平稳转移概率。
  - 状态空间（取值）是有限或可数的马尔科夫过程称为马尔科夫链，如泊松过程；所有样本（实现、取值）均为连续函数的马尔科夫过程称为扩散过程，如布朗运动。

- 平稳过程
  - 严格平稳：即联合概率分布有时间平移不变性。
  - 宽平稳或协方差平稳：协方差结构有时间平移不变性。
  - 注意：有平稳转移概率的马尔科夫过程并不一定是平稳过程，因为前者要求知道当前时刻取值。
- 更新过程和更新计数过程
  - 有一列随机变量$$\{X_n\}$$，令$$S_N = \sum_{n = 1}^{N} X_n，N_t = \max_n\{S_n <= t\}$$。

- 点过程
  - 指标集是N维空间的一些子集的集合，状态空间是自然数。比如每个变量表示一个区域中随机点的总数。



## 第二章 马尔可夫过程

- 转移矩阵：适用于离散时间、离散状态、具有平稳转移概率的马尔可夫过程
- 一维随机游动模型：
  - $$X_N = \sum_{i = 1}^n \xi_i$$，其中$$\xi_i$$相互独立且只能取自然数，可推出$$P_{ij} = Pr\{\xi = j - i\}$$，是一个每条对角线上的数相等的上三角矩阵（如果可取所有整数则有下半边）
  - 一维随机游动模型即$$\xi \in \{-1,+1\}$$的情况。
- “赌徒输光”模型：
  - 一种特殊的一维随机游走模型，有两个吸收态（即只能转移到自己）
  - 不妨认为B是赌场，即n无穷大，此时无论p取多少A都以概率为1输光
- 艾伦费斯特模型：
  - 有两个反射态的一维随机游走模型
  - 比如在两个容器中来回放球
- 对称随机游动：
  - 比如在n维超立方体的每个顶点上都是$$2^{-n}$$
  - n维布朗运动的离散形式
- 离散排队马尔科夫链：
  - 每次转移时走一个人（若有）并加$$\xi_i$$个人
  - 表现为加了一行的上三角矩阵
  - 根据每分钟人数增加的期望可分为三种情况，队列长度无限、稳定或常返
- 存储模型：
  - 每次取走$$\xi_i$$个存货
  - 每次若低于一个阈值则补到另一个阈值
- 成功的游程：
  
  - 伯努利实验的成功游程长度（比如连胜长度的转移过程）
- 分支过程：
  - 一类生物每代繁衍后代的个数为$$\xi_i$$
  - 研究第n代的个体数分布，可以发现转移概率是i个随机变量的和等于j - i的概率，可以用母函数的i次方的幂级数展开系数表示
- 遗传变异：
  
  - 存在平稳概率分布而非吸引子
- n步转移概率矩阵：等于矩阵的n次幂

  - 不可约性：如果所有状态之间都是互通的，则称这个马克科夫链是不可约的
  - 将互通性视为一种等价关系，可以对n个状态划分等价类。比如赌徒输光模型有三个等价类（两个吸引子以及内部）。
- 状态i的周期d(i)：使$$P_{ii}^{n} > 0$$的所有n的**最大公约数**，或**0（若没有这样的n）**。
  - 注意$$P_{ii}^{n}$$不一定大于0
  - 若ij互通，则它们的周期相等
  - 若所有状态的周期都为1，则称这个链是非周期的
  - 定理二（极限）和推论
- 首次到达概率：即从状态i经过n步后首次到达状态j的概率，注意n=0时全部都是0.
  - 推导：用n步转移概率的递推公式写成母函数（拉氏变换）得$$P_{ij}(s) = F_{ij}(s)P_{jj}(s) + (i == j)$$可得F
    $$
    F_{ij}(s) = \begin{cases}
    	\frac{P_{ij}(s)}{P_{jj}(s)} & i \ne j \\
    	\frac{P_{ii}(s) - 1}{P_{ii}(s)} & i = j \\
  	\end{cases}
    $$
  
  - 常返性：若$$\lim \sum_{n = 1}^{\infin} f_{ii}^{n} = 1$$，称状态i是常返的，否则称为瞬态。
    - 充要条件：$$\sum_{n = 1}^{\infin} P_{ii}^n = \infin$$，用数学归纳法证明
    - 若i，j互通且i常返，则j也常返：使用C-K公式放缩
    - 条件同上，则还有$$\lim \sum_{n = 1}^{\infin} f_{ij}^{n} = 1$$
  
- 常返马尔科夫链：

  - 整数集一维随机游动：只需对状态0证明。只有p = q是常返的，否则都是瞬态。

  - 二维整数格点随机游动：同上并假设向四个方向都是1/4。i，j分别表示向左和向上的次数。发现总是常返的。

  - 三维：同上，各方向概率相同。用i，j和n - i - j表示，然后使用PDF上的方法，发现是收敛的，因此也是瞬态。

    **喝醉的酒鬼总能找到回家的路，喝醉的小鸟则可能永远也回不了家。**

  - 成功游程：见PDF



## 第三章 极限定理

### 离散更新方程

- 更新方程：数列的性质

  （注：课件里的例子不符合条件）



### 马尔可夫链基本极限定理

- $$ \lim _{n \to \infin} P^n_{ii} = \frac{1}{\sum_{m = 0}^{\infin} mf^m_{ii}}$$，注意分母就是首次到达时间的期望

  证明：注意到p与f的关系（见前面）是满足更新方程的。

- 在上一题同样条件（常返不可约非周期）下，$$\lim_{n \to \infin} P^n_{ii} = P^n_{ji}$$

- 若C是一个常返类且i和j一个属于C一个不属于C，则对任意n有$$P_{ij} = 0$$

  反证：若i跑到j则不能有通路回来（否则同属一个类），则会有一定概率i永远回不到i

  由这个性质，可以把这个类单独抽出来变成一个常返不可约马尔可夫链

- $$\lim _{n \to \infin} \sum_{m = 0}^{\infin} P_{ii}^m / n = \lim_{n \to \infin} P_{ii}^n$$

- 对于周期为d的常返链有$$ \lim _{n \to \infin} P^{nd}_{ii} = \frac{d}{\sum_{m = 0}^{\infin} mf^m_{ii}}$$，非d倍数则为0

- 常返的类别：

  - 正常返或强遍历性：若$$\lim_{n \to \infin} P^n_{ii} > 0$$则对任意i都成立
  - 若对所有i都等于零则为零常返或弱遍历

- 平稳概率分布：

  - 对于正常返非周期链类，$$\lim _{n \to \infin} P^n_{ij} = \pi_j = \sum_{i} \pi_i P_{ij}, \sum_i \pi_i = 1, \pi_i \ge 0$$，并且$$\pi_i$$被该方程组唯一确定。称$$\pi_i$$为平稳概率分布，有$$\pi P =  \pi$$



### 吸收概率

- 对于瞬态j，有$$\lim_{n \to \infin} P_{ij}^n = 0$$

  使用母函数关系证明。

- 对于从瞬态i到常返态j的吸收情况，先考虑在n步时仍然没有进入任意常返态的概率$$x_i^n$$，可以递推。

- 若一条链只有有限个状态，则至少有一个状态是常返态，且不存在零常返状态
  - 前者的证明：直接$$\sum_j P^n_{ij}$$推到无穷即可
  - 后者：反证，取出该零常返类用类似方法
- 吸收概率：定义$$\pi_i^n(C)$$为从瞬态i出发，在n步后被常返类C吸收（第一次到达C类）的概率，可以递推列出方程组，可得若j在C内，有$$\lim_{n \to \infin} P_{ij}^n = \pi_i(C)\lim_{n \to \infin} P^n_{jj} = \pi_i(C)\pi_j$$.



### 常返性准则

- 设不可约马尔可夫链的状态空间为非负整数集，则它所有状态为**瞬态**的充要条件是：关于Y的方程*PY除了第一行以外等于Y*有非常数有界解。
  - 必要性：把第一个状态改成吸收态，算新的链的吸收概率，则它等于原始的链的首次到达状态0概率。所有状态都是瞬态可得（见PPT?）
  - 充分性：

- 排队例子

  - 如果单位时间来人的期望大于一，运用上面的定理4.1可知是瞬态。

    令$$y_j = \xi ^j$$，把方程代表的函数跟f(x) = x对比，证明在（0,1）之间有解即可。

  - 如果小于一，用定理4.2，其中一个解为$$y_j = j$$可知常返

- 随机游动
  - 用定理4.1，把式子写开可以写出通项公式，可以推出解是常数解和另一个特解的线性组合，如果该特解有有界解则瞬态，否则常返。
  - 可以用期望来表示结果



### M-H算法

- 逆向马尔科夫链：把一个链倒过来也还是马尔科夫链，其转移概率可以用贝叶斯公式算
- 细致平衡：$$\pi_i P_{ij} = \pi_j P_{ji}$$
  - 满足细致平衡的链是可逆的
- 遍历性：不可约正常返非周期细致平衡。此时上面的pi就是唯一的平稳概率分布。
- M-H链：
  - 根据提议分布采样下一个x
  - 根据接受概率接受x，或者保持在原位置
  - 算法：给定想要的平稳概率Pi，设计提议分布Q，计算合适的接受概率A以实现细致平衡
    - Q既要分布广，也要保证不导致A太小，才能尽快收敛



## 连续时间马尔科夫链

### 泊松过程

- 切入点：给出$$\lim_{\tau \to 0} P_{ij}(\tau)$$的表达式然后列微分方程
- 用$$P_{ij}(\tau)$$表示开始时计数为i，经过时间tau计数变为j的概率，有$$\lim_{\tau \to 0} P_{x, x+1}(\tau) = \lambda \tau + o(\tau)$$.（假设在足够短时间内要么加一要么就不变），即
- 钓鱼例子



### 纯生过程

- 事件在给定时刻发生的概率与已发生的事件数目有关，定义为$$\lim_{\tau \to 0} P_{k, k+1}(\tau) = \lambda_k \tau + o_1(\tau)$$且$$\lim_{\tau \to 0} P_{k, k}(\tau) = 1 - \lambda_k \tau + o_2(\tau)$$.

- 设X(0) = 0.记$$P_n(t) = P_{0n}(t) = Pr\{X(t) = n\}$$.可得$$P_n(t+h) = P_n(t)[1 - \lambda_nh] + P_{n-1}(t)\lambda_{n-1}h + o(h) + \sum_{k = 1}^n o_k(h)$$，移项即可得$$P_n'(t)$$的微分方程。需要使用积分因子求解（给定所有lambda）：
  $$
  P'_0(t) = -P_0(t) \lambda_0 \\
  P'_n(t) = -P_n(t) \lambda_n + P_{n - 1}(t) \lambda_{n-1} \\
  P_0(0) = 1, P_n(0) = 0
  $$

- 另一种视角：使用“等待时间”$$T_k$$（某次增加1使用的时长）和增值时间$$S_k$$（时刻，即前面T的和）研究，可以证明$$T_k$$服从指数分布，$$S_k$$可以用特征函数求解
  $$
  P'_0(t) = -P_0(t) \lambda_0, P_0(0) = 1 \to P_0(t) = e^{-\lambda_0t} \\
  Pr\{T_0 \le z\} = 1 - e^{-\lambda_0t}
  $$

  即参数为$$\lambda_0$$的指数分布。同理易得$$T_k$$服从参数为$$T_k$$的指数分布。



### 生灭过程

- 连续时间的随机游动（+1或-1或不变），假设在很短时间内加一或减一的概率与区间长度成正比
- 等候时间的微分方程：易知在i处等候时间服从参数为$$\lambda_i + \mu_i$$指数分布
- 可以从另外一个视角看待：先按指数分布等待，然后按比例转移到两个状态中的一个
- 转移概率的微分方程（类似上面泊松过程的方程）：
  - 向后（把(0, t+h)分成(0, h)和(h, t+h)两段）：$$P_{ij}'(t) = \mu_iP_{i - 1,j}(t) - (\lambda_i + \mu_i)P_{ij}(t) + \lambda_iP_{i+1, j}(t)， P'_{0j}(t) = -\lambda_0(t)P_{0j}(t) +\lambda_1(t) P_{1j}(t)$$，其中lambda是加一概率mu是减一概率
  
    $$P'(t) = AP(t)$$，其中A是无穷小生成元
  
  - 向前（把(0, t+h)分成(0, t)和(t, t+h)两段）：$$P'(t) = P(t)A$$，有一定条件
- 平稳概率分布：
  
  - 用向前微分方程计算：$$0 = P'(t) = PA = \begin{bmatrix} p_{\infin} \\ p_{\infin} \\ \vdots \end{bmatrix}A$$，故$$p_{\infin}A = 0$$且$$p_{\infin}$$加起来是1；也可以跟离散一样$$\mathcal{P}_{\infin} = \mathcal{P}_{\infin}P$$
  
- 可以有解析解，用数列tau表示：
    $$
    \tau_0 = 1, \tau_n = \frac{\prod_{i = 0}^{n - 1}\lambda_i}{\prod_{j = 1}^n \mu_j} \\
    p_j = \begin{cases} \frac{\tau_j}{\sum_k \tau_k} & \sum_k \tau_k <\infin \\
    0 & \sum_k \tau_k = \infin\end{cases}
    $$
  
- 例子：
  - 有迁入的线性增长：
    - 直接求M的微分方程而非P的
  - 排队：
    - 人来的间隔时间服从指数分布（参数为$$\lambda $$）
    - 服务时间也为指数分布（参数为$$\mu$$）
  - 某些遗传模型
  - Logistic过程：种群数量在N1和N2间波动，且每个个体的生灭比例为$$\lambda = \alpha (N_2 - X(t)), \mu = \beta (X(t) - N_1)$$，

- 带有吸收状态的生灭过程
  - 不考虑停留时间，只考虑每次转移，和离散随机游走一样，用$$u_i$$表示从第i个状态出发被吸收的概率，可以递推解出所有吸收概率
  - 平均吸收时间：把平均逗留时间代进去
    - 在状态i的平均逗留时间为$$\frac{1}{\lambda_i + \mu_i}$$
    - 记从状态i开始的平均吸收时间为$$\omega_i$$，则$$\omega_i = \frac{1}{\lambda_i + \mu_i} + \omega_{i + 1}\frac{\lambda_i}{\lambda_i + \mu_i} + \omega_{i - 1}\frac{\mu_i}{\lambda_i + \mu_i}$$
  - 解出为定理7.1

- 有限状态连续时间马尔科夫链

  - 可以证明无穷小“生成元”矩阵存在：

    $$\lim_{h \to 0} \frac{P(h) - I}{h} = A$$，故$$P'(t) = P(t)A = AP(t)$$，且$$P(0) = I$$，故$$P(t) = e^{At} = I + \sum_{n = 1}^{\infin}\frac{A^nt^n}{n!}$$

  - 可以用A特征值分解后解出解析解



## 更新过程

- $$N(t)$$定义为时间区间(0, t]内某一事件重复发生的次数，这一事件出现的间隔时间$$X_i$$独立同分布，分布函数为F(t)，另外事件出现的时刻（即X的部分和）为$$S_n = \sum_{i = 1}^n X_j$$，可知$$P(N(t) \ge k) = P(S_k \le t)$$。记更新函数$$M(t) = E[N(t)]$$。

- $$S_k(t)$$的分布$$F_k(t)$$可以用卷积计算，$$F_1(t) = F(t)$$。

- $$P(N(t) = k) = F_k(t) - F_{k+1}(t)$$可得$$M(t) = \sum_{k = 1}^{\infin}kP(N(t) = k) = \sum_{i = 1}^{\infin}P(N(t) \ge k) = \sum_{i = 1}^{\infin}F_k(t)$$.

- 用$$\delta_t, \gamma_t$$分别表示在t之前和之后一段时间内没有发生更新的概率（现龄和剩余寿命），可知剩余寿命就是服从X的分布

- 令全寿命为$$\beta_t = \delta_t + \gamma_t$$，计算其分布可知全寿命的均值明显大于更新区间的平均长度

  - 原因：任意固定观测时间t，则$$\beta_t$$为包括点t的更新区间的长度，那么它更偏向较长的更新区间而非较短的更新区间

- 替换模型（到一定寿命就替换）

  - 用Y表示“真正损坏”（在N个T后有一个小于T的间隔）的时间长短，计算分布即前面N次方后面一个条件概率，可得Y的期望即$$\frac{\mu_T}{F(T)}$$，也就是更新间距除以“真正损坏”的比例的期望

- 可证$$M(t) = F(t) + (F*M)(t)$$，使用更新论证法证明，即研究从第一个事件出现时开始的一个更新过程：
  $$
  E[N(t)|X_1 = x] = \begin{cases}
  	0, & x > t \\
  	1 + M(t-x), & x \le t
  \end{cases} \\
  M(t) = \int_0^t (1 + M(t-x)) dF(x) = F(t) + (F*M)(t)
  $$

- 更新方程求解定理：若a(t)和F(t)已知，则方程$$A(t) = a(t) + \int_0^t A(t - \tau)dF(\tau)$$的解为：$$A(t) = a(t) + \int_0^t a(t-\tau)dM(\tau)$$，其中$$M(t) = \sum_{k = 1}^{\infin} F_k(t)$$

- 利用更新方程并令$$A(t) = E[S_{N(t)+1}]$$可得$$E[S_{N(t) + 1}] = E[X_1][M(t) + 1]$$

- 初等更新定理：平均更新时间的极限等于$$E[X_1]$$。

- （基本）更新定理：若a(t)在$$[0, \infin)$$黎曼可积，且F不是算术的（见46页），则上面方程$$A(t) = a(t) + \int_0^t A(t - \tau)dF(\tau)$$的解满足：
  $$
  \lim_{t \to \infin} A(t) =
  \begin{cases} \frac{1}{\mu}\int_0^{\infin}a(x)dx, & \mu < \infin \\
  0, & \mu = \infin
  \end{cases}
  $$
  其中$$\mu = E[X_1]$$为平均更新间隔。

  若它是算术的，形式为累加和。

  基本更新定理的第二种形式：$$\lim_{t \to \infin} E[M(t+h) - M(t)] = \frac{h}{\mu}$$
  
- 更新定理的应用：研究剩余寿命和全寿命的分布

  - 记$$A_z(t)$$为在t时刻剩余寿命大于z的概率，则有：
    $$
    A_z(t) = 1 - F(t+z) + \int_0^t A_z(t - \tau)dF(\tau)
    $$
    其中τ表示第一次发生事件的时刻，前面一项表示0-t都未发生事件且剩余寿命大于z（即0到t+z都未发生事件）的概率。

    使用更新方程求解定理可得$$A_z(t) = 1 - F(t+z) + \int_0^t [1-F(t+z-\tau)]dM(\tau)$$。

    使用更新定理可得$$\lim_{t \to \infin} A_z(t) = \frac{\int_z^\infin [1 - F(y)]dy}{\mu}$$。

  - 全寿命的分布：记$$K_x(t)$$为在t时刻全寿命大于x的概率，则有
    $$
    K_x(t) = 1 - F(\max(x, t)) + (K_x * F)(t)
    $$
    解释类似上一条方程。

    运用更新定理可得:
    $$
    \lim_{t \to \infin} K_x(t) = \frac{1}{\mu} \int_x^\infin \xi dF(\xi) \\
    E_{t \to \infin}[x] = \frac{1}{\mu}\int_0^\infin x^2f(x) dx = \frac{E[X^2]}{E[X]} \ge E[X]
    $$
    说明全寿命的期望确实大于平均更新间隔，即“长度偏倚”在所有更新过程中都存在。

  - 更新函数的渐进展开式：可证$$\lim_{t \to \infin} M(t) - \frac{t}{\mu} = \frac{\sigma^2 - \mu^2}{2\mu^2}$$，其中$$\sigma^2$$是F的方差。